<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="css/style.css">
        <title>Textbox Personnalisé</title>
    <body><div class="flex-container">
            <div class="corps"> <fieldset>
                    <legend>ECF : TP FORMULAIRE D’ABSENCE</legend>
                    <div class="header">
                        <h1>Autorisation d'Absence</h1> <img src="LOGOafpa.png" width="100" height="60" alt="logo_afpa"/>
                        <hr class="hr-header">
                    </div>
                </fieldset>
                <form id="myForm" method="Get" action="formulaireConf.html">
                    <fieldset>
                        <legend>Identification:</legend>
                        <label for="nom">Votre nom est:</label>
                        <input type="text" id="nom-textbox" name="nom"  placeholder="Votre Nom" readonly=""><br><br>
                        <label for="prenom">Votre prenom est:</label>
                        <input type="text" id="prenom-textbox" name="prenom" placeholder="Votre Prenom" readonly=""><br><br>
                        <!-- Label pour la liste déroulante -->
                        <label for="formation">vous suivez la Formation  :</label>
                        <!-- Liste déroulante (Dropdown) -->
                        <select id="formation" name="formation">
                            <option value="CDA" >Concepteur Développeur d'Applications</option>
                            <option value="DWWM">DWWM</option>
                            <option value="TSSR">TSSR</option>
                        </select>

                    </fieldset>


                    <!--===================================================================================================================-->
                    <!-- Choix de Radio Buttons -->
                    <label>
                        <input type="radio" id="oui" name="choice" value="fieldset1" onclick="toggleFieldset('fieldset1')" checked> Un jour au moins--- 
                    </label>

                    <label>
                        <input type="radio" id="non" name="choice" value="fieldset2" onclick="toggleFieldset('fieldset2')"> Plus d'un jour ----
                    </label>

                    <!-- Fieldsets à afficher -->
                    <fieldset id="fieldset1">

                        <legend>Demande de l'autorisation de s'absenter du centre</legend>
                        <label for="datejour">Sélectionnez une date :</label>
                        <input type="date" id="datejour" name="date"><br><br>
                        <label for="debut-heure">De:</label>
                        <input type="time" id="debut-heure" name="debut-heure" min="08:00" max="17:00" required /><br><br>

                        <label for="fin-heure">A:</label>
                        <input type="time" id="fin-heure" name="fin-heure" min="08:00" max="17:00" required />
                    </fieldset>

                    <fieldset id="fieldset2">
                        <legend>Demande de l'autorisation de s'absenter du centre</legend>
                        <label for="datejourdebut">vous serez absent du:</label>
                        <input type="date" id="datejourdebut" name="date"><br><br>

                        <label for="datejourfin">jusqu'au :</label>
                        <input type="date" id="datejourfin" name="date"><br><br>

                    </fieldset>

                    <fieldset id="liste-formulaires">

                    </fieldset>
                    <button type="submit" onclick="myFunction()"  ></button>
                </form>
            </div> 

            <aside>

                <div class="signature">

                </div>  

            </aside>
        </div>
        <script>
            var data = window.location.search;
            var params = new URLSearchParams(data);

            // Récupérer les éléments input par leur ID
            var nomInput = document.getElementById("nom-textbox");
            var prenomInput = document.getElementById("prenom-textbox");
            var formationInput = document.getElementById("formation");
            var datejourInput = document.getElementById("datejour");
            var datejourdebutInput = document.getElementById("datejourdebut");
            var datejourfinInput = document.getElementById("datejourfin");
            var debutheureInput = document.getElementById("debut-heure");
            var finheureInput = document.getElementById("fin-heure");

            // Récupérer les valeurs des paramètres et les afficher dans les éléments correspondants
            var nom = params.get("nom");
            var prenom = params.get("prenom");
            var formation = params.get("formation");
            var datejour = params.get("datejour");
            var datejourdebut = params.get("datejourdebut");
            var datejourfin = params.get("datejourfin");
            var heuredebut = params.get("debut-heure");
            var heurefin = params.get("fin-heure");
            var choix = params.get("choice");

            // Mettre à jour le contenu des éléments input
            nomInput.value = nom;
            prenomInput.value = prenom;
            formationInput.value = formation;
            datejourInput.value = datejour;
            datejourdebutInput.value = datejourdebut;
            datejourfinInput.value = datejourfin;
            debutheureInput.value = heuredebut;
            finheureInput.value = heurefin;

            // Récupérer les éléments des boutons radio par leur ID
            var choixOui = document.getElementById("oui");
            var choixNon = document.getElementById("non");

            // Mettre à jour l'état des boutons radio
            if (choix === "fieldset2") {
                choixNon.checked = true;
                toggleFieldset('fieldset2'); // Masquer le fieldset1
            } else {
                choixOui.checked = true;
                toggleFieldset('fieldset1'); // Masquer le fieldset2
            }

            // Fonction pour afficher ou masquer le fieldset en fonction du choix du bouton radio
            function toggleFieldset(fieldsetId) {
                var fieldset1 = document.getElementById('fieldset1');
                var fieldset2 = document.getElementById('fieldset2');

                if (fieldsetId === 'fieldset1') {
                    fieldset1.style.display = 'block';
                    fieldset2.style.display = 'none';
                } else {
                    fieldset1.style.display = 'none';
                    fieldset2.style.display = 'block';
                }
            }
        </script>
        <script>
            // Fonction pour récupérer les données depuis le fichier JSON
            async function fetchData() {
                try {
                    const response = await fetch('motif.json'); // Assurez-vous que le chemin d'accès au fichier est correct
                    const data = await response.json();

                    // Crée une liste pour contenir les formulaires
                    var listeFormulaires = document.getElementById('liste-formulaires');

                    // Boucle à travers les objets "members" et crée le formulaire
                    data.members.forEach(member => {
                        createFormElement(member.id, member.name, member.title, member.options, listeFormulaires);
                    });
                } catch (error) {
                    console.error('Erreur lors de la récupération des données JSON:', error);
                }
            }

            // Fonction pour créer un élément de formulaire à partir des données du membre
            function createFormElement(id, name, title, options, parentElement) {
                var formulaire = document.createElement("form");
                formulaire.appendChild(document.createElement("hr"));
                var titre1 = document.createElement("h2");
                titre1.innerHTML = `${name} - ${title}`;
                formulaire.appendChild(titre1);

                options.forEach(option => {
                    var checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.name = "checkbox1";
                    formulaire.appendChild(checkbox);

                    var checkboxLabel = document.createElement("label");
                    checkboxLabel.innerHTML = option.op_label;
                    checkboxLabel.insertBefore(checkbox, checkboxLabel.firstChild);
                    formulaire.appendChild(checkboxLabel);

                    formulaire.appendChild(document.createElement("br"));

                });

                // Ajoutez le formulaire à la liste
                parentElement.appendChild(formulaire);
            }

            // Appel de la fonction pour récupérer les données et créer le formulaire
            fetchData();
        </script>


    </body>
</html>

